function AWPCPError(e){this.name="AWPCPError",this.message=e||"AWPCP Error."}(e=>{var t=e({});e.subscribe=function(){t.bind.apply(t,arguments)},e.unsubscribe=function(){t.unbind.apply(t,arguments)},e.publish=function(){t.trigger.apply(t,arguments)}})(jQuery),(i=>{function e(){"object"==typeof __awpcp_js_data?this.options=__awpcp_js_data:this.options={},"object"==typeof __awpcp_js_l10n?this.localization=__awpcp_js_l10n:this.localization={},null===this.get("ajaxurl")&&(void 0!==e&&e.ajaxurl?this.set("ajaxurl",e.ajaxurl):"undefined"!=typeof ajaxurl?this.set("ajaxurl",ajaxurl):this.set("ajaxurl","/wp-admin/admin-ajax.php"))}i.extend(e.prototype,{set:function(e,t){return this.options[e]=t,this},get:function(e,t){var n=this;return"undefined"!=typeof awpcp&&awpcp.options&&awpcp.options.length&&(i.each(awpcp.options,function(e,t){n.set(t[0],t[1])}),delete awpcp.options),this.options[e]||t||null},l10n:function(e,t){var n=this;if("undefined"!=typeof awpcp&&awpcp.localization&&awpcp.localization.length&&(i.each(awpcp.localization,function(e,t){n.localization[t[0]]=t[1]}),delete awpcp.localization),this.localization.hasOwnProperty(e)){if(!t)return this.localization[e];if(this.localization[e].hasOwnProperty(t))return this.localization[e][t]}return""},validate:function(e){void 0!==i.validator&&i.validator.setDefaults(e)}}),i.AWPCP=new e,i.AWPCP.PaginationForm=function(e){this.form=i(e),this.form.find("select").change(function(){this.form.submit()})},i.AWPCP.MainMenu=function(e){var t=this;t.container=i(e),t.toggle=t.container.find(".awpcp-menu-toggle"),t.toggle.click(function(){t.container.toggleClass("toggle-on")})},i(function(){i(".awpcp-pagination-form").each(function(){i.noop(new i.AWPCP.PaginationForm(this))}),i(".awpcp-navigation").each(function(){i.noop(new i.AWPCP.MainMenu(i(this)))})})})(jQuery),AWPCPError.prototype=new Error,AWPCPError.prototype.constructor=AWPCPError;var AWPCP=function(){var s={},o={};function i(e,t,n){s[e]={dependencies:t,handler:n}}function a(e){try{!function e(t){var n=s[t];if(o[t])return o[t];if(void 0===n)throw new AWPCPError("Dependency ["+t+"] not found.");var i=[];for(var a=n.dependencies.length-1;0<=a;a-=1)i.unshift(e(n.dependencies[a]));o[t]=n.handler.apply(null,i);return o[t]}(e)}catch(e){if(!(e instanceof AWPCPError))throw e;t("AWPCP: "+e.message)}}function e(e,t){return console&&console[e]&&console[e].apply&&console[e].apply(console,t)}function t(){return e("error",arguments)}return{instantiate:a,define:i,run:function(e,t,n){i(e,t,n),a(e)},log:function(){return e("log",arguments)},error:t}},AWPCP=new AWPCP(window);AWPCP.define("jquery",[],function(){if(void 0===window.jQuery)throw new AWPCPError("jQuery was not loaded before AWPCP.");return window.jQuery}),AWPCP.define("knockout",[],function(){return ko}),AWPCP.define("awpcp/categories-selector-helper",["jquery"],function(e){function t(e,t,n){function a(n,i){void 0!==t[n]&&(void 0===o.hierarchy[n]&&(o.hierarchy[n]=[]),_.each(t[n],function(e){var t=e.name.replace(/&amp;/g,"&");s={id:e.term_id,text:t,disabled:e.disabled||!1,name:t,parent:"root"!==n?n:null,level:i},o.allCategories.push(s),o.allCategoriesIds.push(s.id),o.hierarchy[n].push(s),o.registry[e.term_id]=s,o.parents[e.term_id]=n,s.fullName=o.getCategoryFullName(s.id),void 0!==o.namesRegistry[t]?(o.namesRegistry[t][0].requiresFullName=!0,s.requiresFullName=!0,o.namesRegistry[t].push(s)):o.namesRegistry[t]=[s],a(s.id,i+1)}))}var s,o=this;this.allCategories=[],this.allCategoriesIds=[],this.selectedCategoriesIds=e,this.registry={},this.hierarchy={},this.parents={},this.namesRegistry={},this.paymentTerms=n,a("root",0)}return e.extend(t.prototype,{getAllCategories:function(){return this.allCategories},getAllCategoriesIds:function(){return this.allCategoriesIds},getCategoriesAncestors:function(e){for(var t,n=[],i=0;i<e.length;i+=1)for(t=e[i];-1===n.indexOf(t)&&n.push(t),(t=this.getCategoryParent(t))&&"root"!==t;);return n},getCategory:function(e){return this.registry[e]},getCategoryFullName:function(e){for(var t,n=e,i=[this.getCategory(e).name];"root"!==this.parents[n];)n=(t=this.getCategory(this.parents[n])).id,i.push(t.name);return i.reverse().join(": ")},getCategoryParent:function(e){return this.parents[e]},getCategoryChildren:function(e){return void 0!==this.hierarchy[e]?this.hierarchy[e]:[]},updateSelectedCategories:function(e){this.selectedCategoriesIds=e},getCategoriesThatCanBeSelectedTogether:function(){var t=this;if(0===t.paymentTerms.length)return t.allCategoriesIds;for(var e=_.compact(_.map(_.keys(t.paymentTerms),function(e){e=t.paymentTerms[e];return 0<e.categories.length&&0!==_.difference(t.selectedCategoriesIds,e.categories).length||0<e.numberOfCategoriesAllowed&&e.numberOfCategoriesAllowed<=t.selectedCategoriesIds.length?null:e})),n=[],i=e.length-1;0<=i;i-=1){if(0===e[i].categories.length){n=t.allCategoriesIds;break}n=_.union(n,e[i].categories)}return n}}),t}),AWPCP.define("awpcp/categories-selector",["jquery","awpcp/categories-selector-helper","awpcp/settings"],function(r,n){r.fn.select2.amd.define("awpcp/select2/data/array",["select2/utils","select2/data/array"],function(e,t){function n(e,t){this.helper=t.get("helper")||null,this.multiple=t.get("multiple"),this.cache={term:"",items:[]},n.__super__.constructor.call(this,e,t)}return e.Extend(n,t),n.prototype.query=function(s,t){var o=this;o.current(function(e){var n=[],i=null,a=r.map(e,function(e){return parseInt(e.id,10)}),i=o.multiple?o.helper.getCategoriesThatCanBeSelectedTogether():o.helper.getAllCategoriesIds();o.$element.find("option").each(function(){var e=o.item(r(this)),t=o.matches(s,e);null!==t&&(o.shouldDisableCategory(e,a,i)&&(t=r.extend({},t,{disabled:!0})),n.push(t))}),t({results:n})})},n.prototype.shouldDisableCategory=function(e,t,n){e=parseInt(e.id,10);return null!==n&&!_.contains(t,e)&&!_.contains(n,e)},n.prototype.matches=function(e,t){var n=this;return e.term&&""!==e.term.trim()?(n.cache.term!==e.term&&(n.cache.term=e.term,n.cache.items=[]),-1!==n.cache.items.indexOf(parseInt(t.parent,10))?(n.cache.items.push(parseInt(t.id,10)),t):-1!==t.text.toLowerCase().indexOf(e.term.toLowerCase())?(n.cache.items.push(parseInt(t.id,10)),t.fullName?(e=t.fullName,r.extend({},t,{text:e})):t):null):t},n}),r.fn.select2.amd.define("awpcp/select2/results",["select2/utils","select2/results"],function(e,t){function i(e,t,n){i.__super__.constructor.call(this,e,t,n)}return e.Extend(i,t),i.prototype.option=function(e){var t=i.__super__.option.call(this,e),n=e.level?e.level+1:1;return e.id&&r(t).addClass("awpcp-category-dropdown-option-"+e.id).addClass("awpcp-category-dropdown-option-level-"+n),t},i});function e(e,t){this.$select=r(e),void 0!==r.fn.selectWoo&&(this.options=r.extend({},window["categories_"+this.$select.attr("data-hash")],t),this.options.helper=new n(this.options.selectedCategoriesIds,this.options.categoriesHierarchy,this.options.paymentTerms),this.$select.on("change.select2",_.bind(this.onChange,this)),this.render())}return r.extend(e.prototype,{onChange:function(){var e=this,t=e.getSelectedCategoriesIds();this.options.helper.updateSelectedCategories(t),r.isFunction(e.options.onChange)&&e.options.onChange(e.getSelectedCategories()),r.publish("/categories/change",[e.$select,t])},getSelectedCategories:function(){return void 0===r.fn.selectWoo?r.map(this.$select.find("option:selected"),function(e){return""===e.value?null:{id:parseInt(e.value,10),name:e.text}}):r.map(this.$select.selectWoo("data"),function(e){return""===e.id?null:{id:parseInt(e.id,10),name:e.text}})},clearSelectedCategories:function(){this.$select.val(null).trigger("change")},getSelectedCategoriesIds:function(){return void 0===r.fn.selectWoo?r.map(this.$select.find("option:selected"),function(e){return parseInt(e.value,10)}):r.map(this.$select.selectWoo("data"),function(e){return parseInt(e.id,10)})},render:function(){var t=this,e=r.extend({},this.options.select2),n=this.$select,i=n.find(".awpcp-dropdown-placeholder");try{e.dataAdapter=r.fn.select2.amd.require("awpcp/select2/data/array"),e.resultsAdapter=r.fn.select2.amd.require("awpcp/select2/results")}catch(e){}e.helper=this.options.helper,e.data=r.map(this.options.helper.getAllCategories(),function(e){return 0<=r.inArray(e.id,t.options.selectedCategoriesIds)&&(e.selected=!0),e}),e.templateSelection=function(e){return e.fullName||e.text},i.length?(i.text(""),n.find("option").not(i).remove()):n.empty(),void 0!==r.fn.selectWoo&&n.selectWoo(e)}}),e}),AWPCP.define("awpcp/category-dropdown",["jquery","awpcp/categories-selector-helper"],function(s,n){function e(e,t){var i=this,e=(this.$select=s(e),this.$select.attr("target")),a=(this.options=s.extend({},window["categories_"+this.$select.attr("data-hash")],t),this.options.helper=new n(this.options.selectedCategoriesIds,this.options.categoriesHierarchy,this.options.paymentTerms),this.$container=s(".awpcp-multiple-category-dropdown-container"),this.$hidden=s("#awpcp-multiple-category-dropdown-"+e),window["categories_"+e].categoriesHierarchy);this.$container.on("change",".awpcp-multiple-category-dropdown",function(){i.$select=s(this);var e=i.setCategory(this),t=a[e[0]];if(s(this).nextAll(".awpcp-multiple-category-dropdown").remove(),e[0]in a&&0<t.length&&0==i.$select.next(".awpcp-multiple-category-dropdown").length){e='<select class="awpcp-multiple-category-dropdown"><option value="">'+i.options.subcategoryLabel+"</option></select>";$subDropdown=s(e).insertAfter(s(this));for(var n=0;n<t.length;n+=1)$subDropdown.append(s('<option value="'+t[n].term_id+'">'+t[n].name+"</option>"))}}),this.$container.on("change.categoryDropdown",".awpcp-multiple-category-dropdown",_.bind(this.onChange,this))}return s.extend(e.prototype,{onChange:function(){var e=this.getSelectedCategoriesIds();this.options.helper.updateSelectedCategories(e),s.isFunction(this.options.onChange)&&this.options.onChange(this.getSelectedCategories()),s.publish("/categories/change",[this.$select,this.getSelectedCategories()])},getSelectedCategories:function(){var e=this.$hidden.val();return[{id:(e=JSON.parse(e))[0],name:e[1]}]},getSelectedCategoriesIds:function(){var e=this.$hidden.val();return[JSON.parse(e)[0]]},setCategory:function(){var e=[parseInt(this.$select.val(),10)?parseInt(this.$select.val(),10):null,s("option:selected",this.$select).text()];return null==e[0]&&(this.$select=this.$select.prev(".awpcp-multiple-category-dropdown"),0<this.$select.length)&&(e=[parseInt(this.$select.val(),10),s("option:selected",this.$select).text()]),this.$hidden.val(JSON.stringify(e)),e}}),e}),AWPCP.define("awpcp/credit-plans-list",["jquery"],function(n){function e(e,t){this.$container=n(e),this.options=t,this.setup()}return n.extend(e.prototype,{setup:function(){var e=this;e.$container.on("change",'[name="credit_plan"]',function(){e.onChange()})},onChange:function(){n.isFunction(this.options.onChange)&&this.options.onChange(this.getSelectedCreditPlan())},getSelectedCreditPlan:function(){var e=this.$container.find('[name="credit_plan"]:checked');return{id:e.data("credit-plan-id"),name:e.data("credit-plan-name"),price:e.data("credit-plan-price"),summary:e.data("credit-plan-summary")}},clearSelectedCreditPlan:function(){this.$container.find('[name="credit_plan"]').prop("checked",!1)}}),e}),AWPCP.define("awpcp/datepicker-field",["jquery","awpcp/settings"],function(i,a){return function(e,t){var n=this;n.element=i(e),n.textfield=n.element.parent().find("[datepicker-placeholder]"),n.textfield.datepicker(i.extend({},a.l10n("datepicker"),{dateFormat:a.get("date-format"),altField:n.element,altFormat:"yy/mm/dd"},t?t.datepicker:{}))}}),AWPCP.define("awpcp/file-manager",["jquery","knockout","awpcp/file","awpcp/settings"],function(a,s,o,r){function e(e,t,n){var i=this;i.files=s.observableArray([]),i.images=s.observableArray([]),i.attachments=s.observableArray([]),i.imagesAllowed=s.observable(n.imagesAllowed),i.imagesUploaded=s.observable(n.imagesUploaded),i.primaryImageId=s.observable(n.primaryImageId),i.setImageAsPrimary=function(t){i.showLoadingSpinner(t),a.post(r.get("ajaxurl"),{nonce:e,action:"awpcp-set-image-as-primary",listing_id:t.listing_id,file_id:t.id},function(e){"ok"===e.status&&(i.primaryImageId(t.id),i.hideLoadingSpinner(t))})},i.showLoadingSpinner=function(e){a("#file-"+e.id).find(".image-actions .spinner").removeClass("spinner-hidden")},i.hideLoadingSpinner=function(e){a("#file-"+e.id).find(".image-actions .spinner").addClass("spinner-hidden")},i.updateFileEnabledStatus=function(t){var n=this;n.locked||(i.showLoadingSpinner(n),n.locked=!0,a.post(r.get("ajaxurl"),{nonce:e,action:"awpcp-update-file-enabled-status",listing_id:n.listing_id,file_id:n.id,new_status:t},function(e){"ok"!==e.status&&n.enabled(!t),i.hideLoadingSpinner(n),n.locked=!1}))},i.deleteFile=function(t){i.showLoadingSpinner(t),a.post(r.get("ajaxurl"),{nonce:e,action:"awpcp-delete-file",listing_id:t.listing_id,file_id:t.id},function(e){"ok"===e.status&&(i.files.remove(t),(t.isImage?i.images:i.attachments).remove(t),i.hideLoadingSpinner(t))})},i.prepareFiles(e,t),i.defineComputedProperties()}return a.extend(e.prototype,{prepareFiles:function(e,t){var i=this;a.each(t,function(e,t){var n=new o(t,i.primaryImageId);n.enabled.subscribe(i.updateFileEnabledStatus,n),i[t.isImage?"images":"attachments"].push(n),i.files.push(n)})},defineComputedProperties:function(){var e=this;e.haveFiles=s.computed(function(){return 0<e.files().length}),e.haveImages=s.computed(function(){return 0<e.images().length}),e.haveAttachments=s.computed(function(){return 0<e.attachments().length}),e.canUploadImages=s.computed(function(){return e.imagesAllowed()>e.images().length})}}),e}),AWPCP.define("awpcp/file",["knockout"],function(i){return function(e,t){var n=this;n.id=e.id,n.name=e.name,n.listing_id=e.listing_id,n.thumbnailUrl=e.thumbnailUrl,n.iconUrl=e.iconUrl,n.url=e.url,n.enabled=i.observable(parseInt(e.enabled,10)),n.isImage=e.isImage,n.status=i.observable(e.status),n.isPrimaryImage=i.computed(function(){return t()===n.id}),n.getFileClasses=i.computed(function(){var e=[];return n.isPrimaryImage()&&e.push("primary-image"),e.push(n.enabled()?"enabled":"disabled"),e.push(n.status().toLowerCase()),e.join(" ")}),n.getFileId=i.computed(function(){return"file-"+n.id})}}),AWPCP.define("awpcp/file-view-model",["knockout"],function(n){return function(e){var t=this;t.id=e.id,t.name=e.name,t.listingId=e.listingId,t.mimeType=e.mimeType,t.enabled=n.observable(!!parseInt(e.enabled,10)),t.status=n.observable(e.status),t.isPrimary=n.observable(!!e.isPrimary),t.isApproved=n.computed(function(){return"Approved"===t.status()}),t.isRejected=n.computed(function(){return"Rejected"===t.status()}),t.isAwaitingApproval=n.computed(function(){return"Awaiting-Approval"===t.status()}),t.isBeingModified=n.observable(!1),t.thumbnailUrl=n.observable(e.thumbnailUrl),t.iconUrl=e.iconUrl,t.url=e.url,t.progress=n.observable(e.progress?parseInt(e.progress,10):null),t.shouldShowProgressBar=n.computed(function(){return null!==t.progress()})}}),AWPCP.define("awpcp/media-manager",["jquery","knockout","awpcp/file-view-model","awpcp/settings"],function(r,i,l,u){return function(a){var e,s=this;function t(e){return a.allowed_files[e]&&a.allowed_files[e].hasOwnProperty("mime_types")?o(s.files(),a.allowed_files[e].mime_types):[]}function o(e,t){return r.grep(e,function(e){return-1!==r.inArray(e.mimeType,t)})}function n(t,n){t.isBeingModified()||(t.isBeingModified(!0),r.post(u.get("ajaxurl"),{nonce:a.nonce,action:"awpcp-update-file-enabled-status",listing_id:t.listingId,file_id:t.id,new_status:n},function(e){"ok"===e.status&&t.enabled(n),t.isBeingModified(!1)}))}s.files=i.observableArray((e=a.files,r.map(e,function(e){return new l(e)}))),s.images=i.computed(function(){return t("images")}),s.videos=i.computed(function(){return t("videos")}),s.others=i.computed(function(){return t("others")}),s.haveImages=i.computed(function(){return 0<s.images().length}),s.haveVideos=i.computed(function(){return 0<s.videos().length}),s.haveOtherFiles=i.computed(function(){return 0<s.others().length}),s.showAdminActions=i.observable(!!a.show_admin_actions),s.enableFile=function(e){n(e,!0)},s.disableFile=function(e){n(e,!1)},s.deleteFile=function(t){t.isBeingModified(!0),r.post(u.get("ajaxurl"),{nonce:a.nonce,action:"awpcp-delete-file",listing_id:t.listingId,file_id:t.id},function(e){"ok"===e.status&&(r.publish("/file/deleted",{type:t.mimeType}),s.files.remove(t),t.isBeingModified(!1),t.isPrimary())&&0<s.files().length&&s.setFileAsPrimary(s.files()[0])})},s.setFileAsPrimary=function(t){t.isBeingModified(!0),r.post(u.get("ajaxurl"),{nonce:a.nonce,action:"awpcp-set-file-as-primary",listing_id:t.listingId,file_id:t.id},function(e){var n,i;"ok"===e.status&&(r.each((n=t,i=null,r.each(a.allowed_files,function(e,t){if(-1!==r.inArray(n.mimeType,t.mime_types))return i=t.mime_types,!1}),null===i?[]:o(s.files(),i)),function(e,t){t.isPrimary(!1)}),t.isPrimary(!0),t.isBeingModified(!1))})},s.approveFile=function(t){t.isBeingModified(!0),r.post(u.get("ajaxurl"),{nonce:a.nonce,action:"awpcp-approve-file",listing_id:t.listingId,file_id:t.id},function(e){"ok"===e.status&&(t.status("Approved"),t.isBeingModified(!1))})},s.rejectFile=function(t){t.isBeingModified(!0),r.post(u.get("ajaxurl"),{nonce:a.nonce,action:"awpcp-reject-file",listing_id:t.listingId,file_id:t.id},function(e){"ok"===e.status&&(t.status("Rejected"),t.isBeingModified(!1))})},s.getFileCSSClasses=function(e){var t=["awpcp-uploaded-file"];t.push(e.enabled()?"is-enabled":"is-disabled"),t.push("is-"+e.status().toLowerCase()),e.isPrimary()&&t.push("is-primary");return t.join(" ")},s.getFileId=function(e){return"file-"+e.id},r.subscribe("/file/added",function(e,t){s.files.push(new l({id:t.id,name:t.name,mimeType:t.type,status:"Approved",progress:t.percent}))}),r.subscribe("/file/uploaded",function(e,n,t){var i=null;r.each(s.files(),function(e,t){t.id===n.id&&(i=e)}),null!=i?s.files.splice(i,1,new l(t)):s.files.push(new l(t))}),r.subscribe("/file/progress",function(e,t,n){r.each(s.files(),function(e,t){t.id===n.id&&t.progress(n.percent)})}),r.subscribe("/file/failed",function(e,n){var i=null;r.each(s.files(),function(e,t){t.id===n.id&&(i=e)}),null!=i&&s.files.splice(i,1)}),r.subscribe("/file/thumbnail-updated",function(e,t,n,i){r.each(s.files(),function(e,t){t.id===n.id&&t.thumbnailUrl(i)})})}}),AWPCP.define("awpcp/listings-media-uploader-view",["jquery","awpcp/media-uploader-view","awpcp/settings"],function(e,t,n){return t.extend({initialize:function(){var e=this;e._super("initialize"),e.listenTo(e.model,"media-uploader:file-uploaded",_.bind(e.updateUploadRestrictionsMessage,e)),e.listenTo(e.model,"media-uploader:file-deleted",_.bind(e.updateUploadRestrictionsMessage,e)),e.configureBeforeUnloadEventHandler(),e.updateUploadRestrictionsMessage()},configureBeforeUnloadEventHandler:function(){var e=this;window.onbeforeunload=function(){return!!e.model.uploader&&(e.model.uploader.state===plupload.STARTED?n.l10n("media-uploader-beforeunload","files-are-being-uploaded"):0<e.model.uploader.total.queued?n.l10n("media-uploader-beforeunload","files-pending-to-be-uploaded"):0===e.model.uploader.total.uploaded&&n.get("show-popup-if-user-did-not-upload-files")?n.l10n("media-uploader-beforeunload","no-files-were-uploaded"):void 0)}},updateUploadRestrictionsMessage:function(){this.$restrictions.html(this.model.buildUploadRestrictionsMessage())}})}),Backbone.View.prototype._super=function(e){return this.constructor.__super__[e].apply(this,_.rest(arguments))},AWPCP.define("awpcp/media-uploader-view",["jquery"],function(){return Backbone.View.extend({initialize:function(){var e=this.render();e.$dropzone=e.$(".awpcp-media-uploader-dropzone"),e.$browseButton=e.$(".awpcp-media-uploader-browser-button"),e.$restrictions=e.$(".awpcp-media-uploader-restrictions"),e.$dropzone.on("dragover",_.bind(e.onDragOver,e)),e.$dropzone.on("dragleave",_.bind(e.onDragLeave,e)),e.$dropzone.on("drop",_.bind(e.onDragStop,e)),e.model.prepareUploader(e.$el,e.$dropzone,e.$browseButton)},render:function(){return this},onDragOver:function(){this.$dropzone.addClass("awpcp-media-uploader-dropzone-active")},onDragLeave:function(){this.$dropzone.removeClass("awpcp-media-uploader-dropzone-active")},onDragStop:function(){this.$dropzone.removeClass("awpcp-media-uploader-dropzone-active")}})}),AWPCP.define("awpcp/media-uploader",["jquery","awpcp/settings"],function(r,l){return Backbone.Model.extend({initialize:function(){r.subscribe("/file/deleted",_.bind(this.onFileDeleted,this))},prepareUploader:function(e,t,n){var i=this;plupload.addFileFilter("restrict_file_size",_.bind(i.filterFileBySize,i)),plupload.addFileFilter("restrict_file_count",_.bind(i.filterFileByCount,i)),i.uploader=new plupload.Uploader({browse_button:n.get(0),url:l.get("ajaxurl"),container:e.get(0),drop_element:t.get(0),filters:{mime_types:i.getFileTypeFilters(),restrict_file_size:!0,restrict_file_count:!0},multipart_params:{action:"awpcp-upload-listing-media",listing:i.get("settings").listing_id,context:i.get("settings").context,nonce:i.get("settings").nonce},multi_selection:!0,chunk_size:"10000000",runtimes:"html5,flash,silverlight,html4",flash_swf_url:i.get("settings").flash_swf_url,silverlight_xap_url:i.get("settings").silverlight_xap_url}),i.uploader.init(),i.uploader.bind("FilesAdded",i.onFilesAdded,i),i.uploader.bind("UploadProgress",i.onUploadProgress,i),i.uploader.bind("FileUploaded",i.onFileUploaded,i)},filterFileBySize:function(e,t,n){var i,a=this.getFileGroup(t);return null===a?n(!1):t.size>a.max_file_size?(i=(i=(i=l.l10n("media-uploader-strings","file-is-too-large")).replace("<filename>","<strong>"+t.name+"</strong>")).replace("<bytes-count>","<strong>"+a.max_file_size+"</strong>"),r.publish("/messages/media-uploader",{type:"error",content:i}),n(!1)):n(!0)},getFileGroup:function(n){var i=null;return r.each(this.get("settings").allowed_files,function(e,t){if(-1!==r.inArray(n.type,t.mime_types))return i=t,!1}),i},filterFileByCount:function(e,t,n){var i,a=this.getFileGroup(t);return null===a?n(!1):a.uploaded_file_count>=a.allowed_file_count?(i=(i=l.l10n("media-uploader-strings","cannot-add-more-files")).replace("<filename>","<strong>"+t.name+"</strong>"),r.publish("/messages/media-uploader",{type:"error",content:i}),n(!1)):(a.uploaded_file_count=a.uploaded_file_count+1,n(!0))},getFileTypeFilters:function(){return r.map(this.get("settings").allowed_files,function(e,t){return{title:t.substr(0,1).toUpperCase()+t.substr(1),extensions:e.extensions.join(",")}})},onFilesAdded:function(e,t){r.each(t,function(e,t){r.publish("/file/added",t)}),e.start()},onUploadProgress:function(e,t){r.publish("/file/progress",[e,t])},onFileUploaded:function(e,t,n){n=JSON.parse(n.response);"ok"===n.status&&n.file?r.publish("/file/uploaded",[t,n.file]):"ok"!==n.status&&(this.decreaseFileCountInGroup(t),t.status=plupload.FAILED,this.uploader.trigger("UploadProgress",t),r.publish("/file/failed",t),r.publish("/messages/media-uploader",{type:"error",content:n.errors.join(" ")})),this.trigger("media-uploader:file-uploaded")},onFileDeleted:function(e,t){this.decreaseFileCountInGroup(t),this.trigger("media-uploader:file-deleted")},decreaseFileCountInGroup:function(e){e=this.getFileGroup(e);null!==e&&(e.uploaded_file_count=e.uploaded_file_count-1)},buildUploadRestrictionsMessage:function(){var n,i,a="",s=[],o={};return l.l10n("media-uploader-strings","upload-restrictions"),r.each(this.get("settings").allowed_files,function(e,t){0<(n=t.allowed_file_count-t.uploaded_file_count)&&(s.push(e),i=t.max_file_size/1e6,i=Math.round(10*i)/10,o["<"+e+"-left>"]="<strong>"+n+"</strong>",o["<"+e+"-max-file-size>"]="<strong>"+i+" MB</strong>")}),a=l.l10n("media-uploader-strings","upload-restrictions-"+s.sort().join("-")),r.each(o,function(e,t){a=a.replace(e,t)}),a}})}),AWPCP.define("awpcp/media-center",["jquery","knockout","awpcp/media-manager","awpcp/media-uploader","awpcp/listings-media-uploader-view","awpcp/thumbnails-generator","awpcp/jquery-messages"],function(s,o,r,l,u,c){function t(e,t){var n=this,e=(n.container=s(e),n.container.find(".awpcp-media-manager")),i=n.container.find("#awpcp-media-uploader"),a=n.container.find(".awpcp-thumbnails-generator");n.container.find(".awpcp-messages").AWPCPMessages(),e.length&&t.mediaManagerOptions&&o.applyBindings(new r(t.mediaManagerOptions),e.get(0)),i.length&&t.mediaUploaderOptions&&(n=new l({settings:t.mediaUploaderOptions}),s.noop(new u({el:i,model:n}))),a.length&&s.noop(new c(a))}return s.fn.StartMediaCenter=function(e){s(this).each(function(){s.noop(new t(s(this),e))})},t}),AWPCP.define("awpcp/jquery-messages",["jquery","knockout","awpcp/messages","awpcp/settings"],function(t,n,i,a){t.fn.AWPCPMessages=function(){return t(this).each(function(){var e=a.get("messages-data-for-"+t(this).attr("data-component-id"));n.applyBindings(new i(e),t(this).get(0))})}}),AWPCP.define("awpcp/messages",["jquery","knockout"],function(a,t){return function(e){var n=this;function i(e,t){n.messages.push(t),setTimeout(function(){var e=n.messages().length;10<e&&n.messages.splice(0,e-10)},2e4)}n.messages=t.observableArray([]),a.each(e.channels,function(e,t){a.subscribe("/messages/"+t,i)})}}),AWPCP.define("awpcp/multiple-region-selector-validator",["jquery"],function(o){function e(){}return o.extend(e.prototype,{showErrorsIfUserSelectedDuplicatedRegions:function(e){var e=o(e),t=this.getMultipleRegionSelectorInstance(e),n=!1;return void 0!==t&&(e.find(".multiple-region:visible").each(function(){t.checkDuplicatedRegionsForField(o(this).attr("id"),!0)&&(n=!0)}),n)},getMultipleRegionSelectorInstance:function(e){return e.find(".awpcp-multiple-region-selector").data("RegionSelector")},showErrorsIfRequiredFieldsAreEmpty:function(e){var e=o(e),t=this.getMultipleRegionSelectorInstance(e),a=null,s=!1;return t&&(o.each(t.regions(),function(e,i){o.each(i.partials(),function(e,t){var n;!t.config.required||(n=t.selected())&&n.length||(i.error(AWPCP.l10n("multiple-region-selector","missing-"+t.type)),a=a||t,s=!0)})}),a)&&e.find('[id="'+a.id+'"]').closest(".awpcp-region-selector-partials").find(":input:visible").last().focus(),s}}),new e}),AWPCP.define("awpcp/payment-terms-list",["jquery","awpcp/settings"],function(i,a){function e(e,t){var n=this;n.$container=e,n.options=t,this.container=e,this.state={allPaymentTerms:this.container.find(".awpcp-payment-term")},i.subscribe("/categories/change",_.bind(this.onCategoriesUpdated,this)),i.subscribe("/user/updated",_.bind(this.onUserUpdated,this)),n.$container.on("change",'[name="payment_term"]',function(){n.onChange()}),this.update()}return i.extend(e.prototype,{onCategoriesUpdated:function(e,t,n){!i.contains(t.closest("form").get(0),this.container.get(0))||null===n&&!a.get("hide-all-payment-terms-if-no-category-is-selected")||(i.isArray(n)?this.state.selectedCategories=n:this.state.selectedCategories=[n],this.update())},onUserUpdated:function(e,t){t&&t.payment_terms&&(this.state.userPaymentTerms=t.payment_terms,this.update())},onChange:function(){i.isFunction(this.options.onChange)&&this.options.onChange(this.getSelectedPaymentTerm())},getSelectedPaymentTerm:function(){var e=this.$container.find('[name="payment_term"]:checked');return e.length?{id:e.data("payment-term-id"),type:e.data("payment-term-type"),mode:e.data("payment-term-mode"),summary:e.data("payment-term-summary"),maxCategories:e.parents("li").data("number-of-categories-allowed")}:null},clearSelectedPaymentTerm:function(){this.$container.find('[name="payment_term"]').prop("checked",!1),this.update()},includesFreePaymentTermOnly:function(){var e=this.state.allPaymentTerms.length;if(1!==e)return!1;for(var t=e-1;0<=t;t-=1)if("fee-0"!==this.state.allPaymentTerms.eq(t).data("id"))return!1;return!0},update:function(){var e,t=this._getDisabledPaymentTerms(),n=this.state.allPaymentTerms.not(t.get());0===n.find(":radio:checked").length&&((e=n.eq(0).find(":radio:first")).prop?e.prop("checked",!0):e.attr("checked","checked"),e.trigger("change")),n.fadeIn(),t.fadeOut()},isMaxCategories:function(){i(".awpcp-submit-listing-page-form select[name='category[]']").parent(".awpcp-form-spacer").find(".awpcp-message-error").remove();var e=i.AWPCP.get("default-validation-messages").maxCategories,t=this.state.selectedCategories,n=0<i(".awpcp-submit-listing-page-form .select2-selection--multiple").length;null!=t&&0<t.length&&!isNaN(t[0])&&n&&this.state.selectedCategories.length>=this.getSelectedPaymentTerm().maxCategories&&i(".awpcp-submit-listing-page-form select[name='category[]']").parent(".awpcp-form-spacer").append('<p class="awpcp-message awpcp-message-error">'+e+"</p>")},_getDisabledPaymentTerms:function(){var t=this,e=t.state.selectedCategories;return(null==e||0===e.length)&&a.get("hide-all-payment-terms-if-no-category-is-selected")||"0"==AWPCPSubmitListingPageData.payments_enabled?t.state.allPaymentTerms:t.state.allPaymentTerms.filter(function(){var e=i(this);return!(!t.state.userPaymentTerms||t._isUserPaymentTerm(e))||!(!t.state.selectedCategories||t._isPaymentTermAvailableForCategories(e))})},_isUserPaymentTerm:function(e){return-1!==i.inArray(e.attr("data-id"),this.state.userPaymentTerms)},_isPaymentTermAvailableForCategories:function(e){var t=JSON.parse(e.attr("data-categories")),e=parseInt(e.attr("data-number-of-categories-allowed"),10);return!(this.state.selectedCategories.length>e||i.isArray(t)&&0!==t.length&&(t=i.map(t,function(e){return parseInt(e,10)}),0!==_.difference(this.state.selectedCategories,t).length))}}),e}),AWPCP.define("awpcp/thumbnails-generator",["jquery","awpcp/settings"],function(r,l){return function(e){var o=this;function n(){var e=o.video.get(0);o.index<o.queue.length?(o.currentItem=o.queue[o.index],o.index=o.index+1,e.src=URL.createObjectURL(o.currentItem.video.getNative()),e.play()):(o.status=0,e.src=null)}o.element=r(e),o.video=o.element.find("video"),o.canvas=o.element.find("canvas"),o.queue=[],o.index=0,void(o.status=0)!==o.video.get(0).canPlayType&&"undefined"!=typeof URL&&void 0!==URL.createObjectURL&&(r.subscribe("/file/added",function(e,t){t.type.match("video.*")&&(o.queue.push({video:t,thumbnail:null}),0===o.status)&&(setTimeout(n,100),o.status=1)}),r.subscribe("/file/uploaded",function(e,n,t){var i,a,s=null;r.each(o.queue,function(e,t){t.video.id===n.id&&(s=t.thumbnail)}),null!==s&&(i=n,a=t,t=s,r.post(l.get("ajaxurl"),{action:"awpcp-upload-generated-thumbnail",nonce:o.element.attr("data-nonce"),file:a.id,thumbnail:t},function(e){"ok"===e.status&&r.publish("/file/thumbnail-updated",[i,a,e.thumbnailUrl])}))}),o.video.bind("canplay",function(){var e=this;r.isNumeric(e.duration)&&!isNaN(e.duration)&&1<Math.abs(e.currentTime-e.duration/2)&&(e.currentTime=e.duration/2,e.pause())}),o.video.bind("seeked",function(){o.currentItem.thumbnail=(()=>{var e=o.video.get(0),t=o.canvas.get(0);return t.width=e.clientWidth,t.height=e.clientHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL()})(),setTimeout(n,100)}))}}),AWPCP.define("awpcp/user-information-updater",["jquery"],function(o){function e(e){var t=this;t.container=e,t.name=t.container.find("input[name=ad_contact_name]"),t.email=t.container.find("input[name=ad_contact_email]"),t.website=t.container.find("input[name=websiteurl]"),t.phone=t.container.find("input[name=ad_contact_phone]"),t.state=t.container.find("input[name=ad_state], select[name=ad_state]"),t.city=t.container.find("input[name=ad_city], select[name=ad_city]")}return o.extend(e.prototype,{watch:function(){var i=this;o.subscribe("/user/updated",function(e,t,n){i.update(t,n)})},update:function(e,t){var n=this,i={},a={name:n.name.val(),email:n.email.val(),website:n.website.val(),phone:n.phone.val(),state:n.state.val(),city:n.city.val()},s={name:e.display_name,email:e.user_email,website:e.user_url,phone:e.phone,state:e.state,city:e.city};o.each(a,function(e){a[e]&&0<a[e].length&&!t?i[e]=a[e]:i[e]=s[e]||""}),n.name.val(i.name),n.email.val(i.email),n.website.val(i.website),n.phone.val(i.phone),this.city.one("awpcp-update-region-options-completed",function(){n.city.val(i.city).change()}),this.state.val(i.state).change()}}),e}),AWPCP.define("awpcp/user-selector",["jquery"],function(i){function e(e,t){var n=this;return n.$select=i(e),n.options=t,void 0!==n.options&&("ajax"===n.options.mode?n.configureAjaxBehavior():n.configureInlineBehavior())}return i.extend(e.prototype,{configureAjaxBehavior:function(){var e=this,t=i.extend(!0,{},e.options.select2,{ajax:{processResults:function(e){return{results:i.map(e.items,function(e){return{id:e.ID,text:e.public_name}})}}}});void 0!==i.fn.selectWoo&&e.$select.selectWoo(t),e.options.selected.id&&(t=new Option(e.options.selected.text,e.options.selected.id,!0,!0),e.$select.append(t).trigger("change")),e.setupEventHandlers()},setupEventHandlers:function(){var e=this;e.$select.on("change.select2",function(){e.onChange()})},configureInlineBehavior:function(){void 0!==i.fn.selectWoo&&this.$select.selectWoo(this.options.select2),this.setupEventHandlers()},onChange:function(){i.isFunction(this.options.onChange)&&this.options.onChange(this.getSelectedUser())},getSelectedUser:function(){var e;return void 0===i.fn.selectWoo?(e=this.$select.find("option:selected")).length?{id:e.val(),name:e.text()}:{id:0,name:""}:(e=this.$select.selectWoo("data"))&&e.length?{id:e[0].id,name:e[0].text}:{id:0,name:""}},clearSelectedUser:function(){this.$select.val(null).trigger("change")}}),e}),AWPCP.run("awpcp/restricted-length-field",["jquery"],function(n){return function(e){var t=this;t.element=n(e),t.container=t.element.parent().find(".characters-left"),t.placeholder=t.container.find(".characters-left-placeholder"),t.allowed=parseInt(t.element.attr("data-max-characters"),10),t.remaining=parseInt(t.element.attr("data-remaining-characters"),10),t.element.bind("keyup keydown",function(){var e=t.element.val();t.allowed<=0||(e.length>t.allowed&&(e=e.substring(0,t.allowed),t.element.val(e)),e=t.allowed-e.length,t.container.removeClass("awpcp-almost-no-characters-left"),t.container.removeClass("awpcp-no-characters-left"),0<e&&e<=20&&t.container.addClass("awpcp-almost-no-characters-left"),e<=0&&t.container.addClass("awpcp-no-characters-left"),t.placeholder.text(e))}).trigger("keyup")}}),AWPCP.define("awpcp/util/guid",[],function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return{generate:function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}}),AWPCP.define("awpcp/util/number-format",["awpcp/settings"],function(l){return{format:function(e,t,n,i){t=isNaN(t=Math.abs(t))?2:t,i=void 0===i?".":l.get("decimal-separator"),n=void 0===n?",":l.get("thousands-separator");var a=Math.abs(+e||0).toFixed(t),s=parseInt(a,10).toString(),o=3<s.length?s.length%3:0,r=o?s.substr(0,o):"";return r+=s.substr(o).replace(/(\d{3})(?=\d)/g,"$1"+n),t&&(r+=i+Math.abs(a-s).toFixed(t).slice(2)),0<=e?r:"("+r+")"}}}),AWPCP.define("awpcp/asynchronous-tasks",["jquery","knockout","moment","awpcp/asynchronous-task","awpcp/asynchronous-tasks-group","awpcp/knockout-progress"],function(t,n,e,a,s){function i(e){this.title=n.observable(e.title),this.introduction=n.observable(e.introduction),this.submit=n.observable(e.submit),this.templates=e.templates,this.group=new s({tasks:this._getTasksGroups(e)}),n.observableArray([])}return t.extend(i.prototype,{_getTasksGroups:function(e){var n=this,i=[];return t.each(e.groups,function(e,t){i.push(new s({title:t.title,content:t.content,successTitle:t.successTitle,successContent:t.successContent,tasks:n._getTasks(t)}))}),i},_getTasks:function(e){var n=this,i=[];return t.each(e.tasks,function(e,t){i.push(new a({name:t.name,description:t.description,action:t.action,context:t.context,recordsCount:t.recordsCount,recordsLeft:t.recordsLeft,templates:n.templates}))}),i},render:function(e){n.applyBindings(this,t(e).get(0))},start:function(){this.group.execute()}}),i}),AWPCP.define("awpcp/asynchronous-tasks-group",["jquery","knockout","moment","awpcp/asynchronous-task"],function(a,t,e,n){function i(e){this.title=t.observable(e.title),this.content=t.observable(e.content),this.successTitle=t.observable(e.successTitle),this.successContent=t.observable(e.successContent),this.tasks=t.observableArray(e.tasks),this.startTime=t.observable(null),this.lastUpdatedTime=t.observable(null),this.tasksCount=this.tasks().length,this.currentTaskIndex=t.observable(0),this.tasksCompleted=t.observable(0),this.tasksLeft=t.computed(function(){return this.tasksCount-this.tasksCompleted()},this),this.running=t.observable(!1),this.completed=t.computed(function(){return 0===this.tasksLeft()},this),this.percentageOfCompletion=t.computed(function(){var e=this.tasks(),n=0,i=0;return a.each(e,function(e,t){n+=t.getWeight(),t.isCompleted()?i+=t.getWeight():i+=t.getWeight()*t.getPercentageOfCompletion()/100}),Math.round(i/n*1e4)/100},this).extend({throttle:1}),this.percentageOfCompletionString=t.computed(function(){return Math.round(this.percentageOfCompletion())+"%"},this),this.updateCurrentTaskIndexAndCompletedTasksCount()}return a.extend(i.prototype,n.prototype,{updateCurrentTaskIndexAndCompletedTasksCount:function(){var n=this.currentTaskIndex(),i=this.tasksCompleted();a.each(this.tasks(),function(e,t){t.completed()&&(n+=1,i+=1)}),this.tasks.sort(function(e,t){return e.completed()<t.completed()?1:e.completed()==t.completed()?0:-1}),this.currentTaskIndex(n),this.tasksCompleted(i)},getRemainingTime:function(){return this.remainingTime},getPercentageOfCompletion:function(){return this.percentageOfCompletion()},getWeight:function(){return this.tasksCount},execute:function(e){var t=this,n=t.currentTaskIndex();if(n>=t.tasksCount){if(t.running(!1),a.isFunction(e))return e()}else t.tasks()[n].execute(function(){t.currentTaskIndex(t.currentTaskIndex()+1),t.tasksCompleted(t.tasksCompleted()+1),setTimeout(function(){t.execute(e)},1)});t.running(!0)}}),i}),AWPCP.define("awpcp/asynchronous-task",["jquery","knockout","moment","awpcp/settings"],function(t,n,r,s){function e(e){var s,o;this.name=n.observable(e.name),this.description=n.observable(e.description),this.action=e.action,this.context=e.context,this.startTime=n.observable(null),this.lastUpdatedTime=n.observable(null),this.failedRequestsCount=n.observable(0),void 0===e.recordsCount?this.recordsCount=n.observable(null):this.recordsCount=n.observable(e.recordsCount),this.recordsLeft=void 0===e.recordsLeft?n.observable(null):n.observable(e.recordsLeft),this.templates=e.templates,this.numberOfRecordsProcessed=n.computed(function(){var e=this.recordsCount(),t=this.recordsLeft();return null!==e&&null!==t?e-t:0},this),this.numberOfRecordsProcessedMessage=n.computed(function(){var e=this.numberOfRecordsProcessed(),t=this.recordsCount(),n=this.templates.itemsProcessed;return n=(n=n.replace("<number-of-items-processed>",e)).replace("<total-number-of-items>",t)},this),this.running=n.observable(!1),this.completed=n.computed(function(){return 0===this.recordsLeft()},this),this.initialPercentageOfCompletion=n.observable(0),this.percentageOfCompletion=n.computed(function(){var e,t=this.recordsCount(),n=this.recordsLeft();return null===n||null===t?e=0:0===n?e=100:0<t&&(e=100*(t-n)/t),Math.round(100*e)/100},this).extend({throttle:1}),this.percentageOfCompletionString=n.computed(function(){return Math.round(this.percentageOfCompletion())+"%"},this),this.remainingTime=n.computed((s=new Date,o=null,function(){var e=this.startTime(),t=this.lastUpdatedTime(),n=this.initialPercentageOfCompletion(),i=this.percentageOfCompletion(),a=new Date;if(!(a-s<2500)){if(null===e||null===t)return null;if(0===i)return null;s=a,o=0<(t=(100-i)*(t-e)/(i-n)/1e3)?r(a).add(t,"seconds").from(a,!0):null}return o}),this)}return t.extend(e.prototype,{getStartTime:function(){return this.startTime()},setStartTime:function(e){this.startTime(e)},getLastUpdatedTime:function(){return this.lastUpdatedTime()},setLastUpdatedTime:function(e){this.lastUpdatedTime(e)},getRemainingTime:function(){return this.remainingTime()},setInitialPercentageOfCompletion:function(e){this.initialPercentageOfCompletion(e)},getPercentageOfCompletion:function(){return this.percentageOfCompletion()},getWeight:function(){return 1},isCompleted:function(){return this.completed()},isRunning:function(){return this.running()},setStatusMessage:function(e){this.messages.status(e)},setErrorMessage:function(e){this.messages.error(e)},execute:function(e){var i=this,a=t.isFunction(e)?e:t.noop;null===i.getStartTime()&&(i.setStartTime(new Date),i.setInitialPercentageOfCompletion(i.getPercentageOfCompletion())),t.ajax(s.get("ajaxurl"),{method:"POST",data:{action:i.action,context:i.context},success:function(e,t,n){i._onSuccess(e,a)},error:function(e,t,n){void 0===n.error&&(n={status:"error",error:n}),i._handleErrorResponse(n,a)}}),this.running(!0)},_onSuccess:function(e,t){"ok"===e.status?this._handleSuccessfulResponse(e,t):this._handleErrorResponse(e,t)},_handleSuccessfulResponse:function(e,t){var n=this;e.message&&n.setStatusMessage(e.message),n.failedRequestsCount(0),n.recordsCount(n.recordsCount()||parseInt(e.recordsCount,10)),n.recordsLeft(parseInt(e.recordsLeft,10)),n.setLastUpdatedTime(new Date),n._handleResponse(t,1)},_handleResponse:function(e,t){var n=this;0===n.recordsLeft()?(n.running(!1),e()):setTimeout(function(){n.execute(e)},t)},_handleErrorResponse:function(e,t){e.error;e=this.failedRequestsCount();e<6&&this.failedRequestsCount(e+1),this._handleResponse(t,1e3*Math.pow(2,e))}}),e}),AWPCP.define("awpcp/collapsible",["jquery"],function(e){function t(e){this.element=e,this.handler=this.element.find(".js-handler").eq(0),this.subject=this.element.find("[data-collapsible]").eq(0)}return e.extend(t.prototype,{setup:function(){var t=this;0===t.subject.length?t.handler.hide():(t.handler.click(function(e){t.toggle.apply(t,[e,this])}),t.subject.is("[awpcp-keep-open]")?t.showExpanded():t.showCollapsed())},showExpanded:function(){this.subject.show(),this.setHandlerClass("close")},showCollapsed:function(){this.subject.hide(),this.setHandlerClass("open")},setHandlerClass:function(e){this.handler.find("span").removeClass("open close").addClass(e)},toggleHandlerClass:function(){this.subject.is(":visible")?this.setHandlerClass("close"):this.setHandlerClass("open")},toggle:function(e){var t=this;e.preventDefault(),t.subject.stop().slideToggle(function(){t.toggleHandlerClass()})}}),t}),AWPCP.define("awpcp/localization",["jquery"],function(n){return{get:function(e,t){return n.AWPCP.l10n(e,t)}}}),AWPCP.define("awpcp/settings",["jquery"],function(e){return e.AWPCP}),AWPCP.define("awpcp/users-autocomplete",["jquery","awpcp/settings"],function(i,a){function e(e){this.field=i(e),this.hidden=this.field.siblings("[autocomplete-selected-value]"),this.previous_value=null}return i.extend(e.prototype,{setup:function(){var n=this,e=a.get("users-autocomplete-default-user");n.field.autocomplete({source:function(e,t){i.getJSON(a.get("ajaxurl"),{action:"awpcp-autocomplete-users",term:e.term},function(e){"ok"===e.status&&t(e.items)})},select:function(e,t){t.item&&n.update(t.item)}}),e&&n.init(e)},init:function(e){this.hidden.val(e.ID),this.field.val(e.public_name),this.previous_value=parseInt(this.hidden.val(),10),i.publish("/user/updated",[e,!1])},update:function(e){var t=this;t.hidden.val(e.ID),t.field.val(e.public_name),t.previous_value=parseInt(t.hidden.val(),10),t=e.ID!==t.previous_value,i.publish("/user/updated",[e,t])}}),e}),AWPCP.define("awpcp/users-dropdown",["jquery"],function($){function UsersDropdown(e){this.field=$(e),this.previous_value=null}return $.extend(UsersDropdown.prototype,{setup:function(){var e=this,t=e.getSelectedUserId();e.field.change(function(){0<e.getSelectedUserId()?e.update(e.getSelectedUser()):e.previous_value=0}),0<t&&e.init(e.getSelectedUser())},getSelectedUserId:function(){return parseInt(this.field.val(),10)},getSelectedUser:function(){var user_information=this.field.find(":selected").attr("data-user-information");return user_information&&JSON.parse?JSON.parse(user_information):user_information?eval("("+user_information+")"):null},init:function(e){this.previous_value=e.ID,$.publish("/user/updated",[e,!1])},update:function(e){var t=this.previous_value!==e.ID;$.publish("/user/updated",[e,t]),this.previous_value=e.ID}}),UsersDropdown}),AWPCP.define("awpcp/jquery-userfield",["jquery","awpcp/users-dropdown","awpcp/users-autocomplete"],function(n,i,a){n.fn.userfield=function(){return n(this).each(function(){var e,t=n(this);t.is("[dropdown-field]")?e=new i(t):t.is("[autocomplete-field]")&&(e=new a(t)),e.setup()})}}),AWPCP.define("awpcp/jquery-collapsible",["jquery","awpcp/collapsible"],function(e,t){e.fn.collapsible=function(){return e(this).each(function(){new t(e(this)).setup()})}}),AWPCP.define("awpcp/jquery-validate-methods",["jquery"],function(i){return i(function(){var e,t,n;void 0!==i.validator&&(i.extend(i.validator.messages,i.AWPCP.get("default-validation-messages")),i.validator.addMethod("oneof",function(e,t,n){return!!this.optional(t)||-1!==i.inArray(e,n)}),i.validator.addMethod("classifiedsurl",function(e,t){return this.optional(t)||/^(?:(https?|s?ftp):\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)}),i.validator.addMethod("money",(e=i.AWPCP.get("decimal-separator"),t=i.AWPCP.get("thousands-separator"),n=new RegExp("^-?(?:\\d+|\\d{1,3}(?:\\"+t+"\\d{3})+)?(?:\\"+e+"\\d+)?$"),function(e,t){return this.optional(t)||n.test(e)})),i.validator.addClassRules("integer",{integer:!0}),i.validator.setDefaults({errorClass:"error invalid",errorElement:"span",errorPlacement:function(e,t){e.addClass("awpcp-error");-1!==i.inArray(t.attr("name"),["payment_term","credit_plan","payment_method"])?e.insertBefore(t.closest("table")):t.closest(".awpcp-form-spacer").length&&e.appendTo(t.closest(".awpcp-form-spacer"))}}))}),!0}),AWPCP.run("awpcp/init-collapsible-elements",["jquery","awpcp/jquery-collapsible"],function(e){e(function(){e(".awpcp-categories-list .top-level-category").closest("li").collapsible()})}),AWPCP.run("awpcp/init-categories-dropdown",["jquery","awpcp/categories-selector"],function(e,t){e(function(){e(".awpcp-category-dropdown[data-auto]").each(function(){e.noop(new t(e(this)))})})}),AWPCP.run("awpcp/init-category-selector",["jquery"],function(e){e(function(){var i=e(".awpcp-category-switcher .awpcp-category-dropdown");e.subscribe("/categories/change",function(e,t,n){-1!==i.index(t)&&n&&t.closest("form").submit()})})}),AWPCP.run("awpcp/reload-payment-completed-page",["jquery"],function(t){t(function(){var e=t("#awpcp-payment-completed-form");0!==e.length&&"Not Verified"===e.find(':hidden[name="payment_status"]').val()&&setTimeout(function(){location.reload()},5e3)})}),AWPCP.run("awpcp/init-recaptcha",["jquery"],function(i){var e=0,t=!1;function n(){var e,n;window.AWPCPGetReCaptchaResponse||((e=i(".awpcp-recaptcha")).length&&(e.each(function(){var e,t=i(this);t.data("awpcp-recaptcha")||(e=grecaptcha.render(this,{sitekey:t.attr("data-sitekey"),theme:"light"}),t.data("awpcp-recaptcha",!0),t.attr("data-recaptcha-widget-id",e))}),window.AWPCPGetReCaptchaResponse=function(e){e()}),(e=i(".awpcp-recaptcha-action")).length&&(n=e.eq(0),window.AWPCPGetReCaptchaResponse=function(t){grecaptcha.execute(n.data("sitekey"),{action:n.data("name")}).then(function(e){n.find(":hidden").val(e),t()})}))}function a(){e+=1,"undefined"!=typeof grecaptcha&&void 0!==grecaptcha.render?n():e<=45&&(t=setTimeout(a,1500*Math.pow(e/45,2)))}window.AWPCPreCAPTCHAonLoadCallback=function(){t&&clearTimeout(t),n()},i(a)});